FROM python:3.13-slim-bookworm
SHELL ["/bin/bash", "-lc"]

# Non-root user (works nicely in Dev Containers)
ARG USERNAME=developer UID=1000 GID=1000
RUN groupadd -g ${GID} ${USERNAME} \
 && useradd -m -s /bin/bash -u ${UID} -g ${GID} ${USERNAME}

# System deps: stable, ML-friendly
RUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
      build-essential curl git ca-certificates \
      pkg-config cmake \
      libopenblas-dev libomp-dev \
 && rm -rf /var/lib/apt/lists/* \
 && curl -sL https://aka.ms/InstallAzureCLIDeb | bash

COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

WORKDIR /workspace
COPY pyproject.toml ./

# No CMD here; compose/devcontainer will decide (sleep/app/etc.)
